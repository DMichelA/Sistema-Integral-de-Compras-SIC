{% extends 'base/base.html' %}

{% load static %}

{% block title %}
Requisicion
{% endblock %}


{% block menu %}
<div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <div class="bg-light border-right" id="sidebar-wrapper">
    <div class="sidebar-heading">SISTEMA INTEGRAL DE COMPRAS </div>
    <!-- Divider -->
    <hr class="sidebar-divider">
    <div class="list-group list-group-flush ">
        <a href="{% url 'insertar_bienes' %}" class="list-group-item list-group-item-action bg-light"><svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-pencil-square" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
            <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
        </svg> Llenado de Bienes/Servicios</a>
        <a href="{% url 'listar_bienes' %}" class="list-group-item list-group-item-action bg-light"><svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-ui-radios" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-1zM0 12a3 3 0 1 1 6 0 3 3 0 0 1-6 0zm7-1.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-1z"/>
            <path fill-rule="evenodd" d="M7 5.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 8a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zM3 1a3 3 0 1 0 0 6 3 3 0 0 0 0-6zm0 4.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/>
        </svg> Listado de Bienes/Servicios</a>
        <a href="{% url 'bienes_verificados' %}" class="list-group-item list-group-item-action bg-light"><svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-ui-checks" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-1z"/>
            <path fill-rule="evenodd" d="M2 1a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2H2zm0 8a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2H2zm.854-3.646l2-2a.5.5 0 1 0-.708-.708L2.5 4.293l-.646-.647a.5.5 0 1 0-.708.708l1 1a.5.5 0 0 0 .708 0zm0 8l2-2a.5.5 0 0 0-.708-.708L2.5 12.293l-.646-.647a.5.5 0 0 0-.708.708l1 1a.5.5 0 0 0 .708 0z"/>
            <path d="M7 10.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-1z"/>
            <path fill-rule="evenodd" d="M7 5.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 8a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/>
        </svg> Bienes/Servicios Verificados</a>
        <a href="{% url 'requisicion' %}" class="list-group-item list-group-item-action bg-light"><svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-file-earmark-ruled" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M5 10H3V9h10v1H6v2h7v1H6v2H5v-2H3v-1h2v-2z"/>
            <path d="M4 0h5.5v1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h1V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2z"/>
            <path d="M9.5 3V0L14 4.5h-3A1.5 1.5 0 0 1 9.5 3z"/>
        </svg> Requisición</a>
        <a href="#" class="list-group-item list-group-item-action bg-light"><svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-search" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M10.442 10.442a1 1 0 0 1 1.415 0l3.85 3.85a1 1 0 0 1-1.414 1.415l-3.85-3.85a1 1 0 0 1 0-1.415z"/>
            <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
        </svg> Historial de Requisiciones</a>
    </div>
    </div>
    <!-- /#sidebar-wrapper -->
    
    <!-- Page Content -->
    <div id="page-content-wrapper">

    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <a class= "navbar-toggler-collapse" id="menu-toggle">
        <svg width="2em" height="2em" viewBox="0 0 16 16" class="bi bi-arrow-right-square-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm2.5 8.5a.5.5 0 0 1 0-1h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5z"/>
        </svg></a>
        <a class= "navbar-brand"><img src="{% static 'img/sicutec.png' %}" height="35px" width="auto" alt=""></a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
            <li class="nav-item active">
            <a class="nav-link" href="{% url 'usuario_index' %}">Home <svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-grid" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5v-3zM2.5 2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zM1 10.5A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3z"/>
            </svg><span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
            <a class="nav-link" href="{% url 'logout' %}?next={% url 'login' %}">Cerrar Sesión <svg width="1.5em" height="1.5em" viewBox="0 0 16 16" class="bi bi-box-arrow-left" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z"/>
                <path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
            </svg></a>
            </li>
            <li class="nav-item dropdown">
            <!--
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Dropdown
            </a>
            -->
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="#">Action</a>
                <a class="dropdown-item" href="#">Another action</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="{% url 'logout' %}?next={% url 'login' %}">Cerrar sesion</a>
            </div>
            </li>
        </ul>
        </div>
    </nav>
{% endblock %}



{% block content %}

<form method="POST">
    {% csrf_token %}
    <br>
    <div class="table-responsive">
        <table class="table table-bordered table table-sm">
            <thead>
                <th>Encabezado General</th>
                <th colspan="4">A.Nombre del formato:</th>
            </thead>
            <thead class="text-center">
                <th><img src="{% static 'img/sicutec.png' %}" height="50px" width="200px"></th>
                <th colspan="4" style="font-size:29px;">REQUISICIÓN DE BIENES Y SERVICIOS</th>
            </thead>
            <thead>
                <th WIDTH="100">F-22-01-R1;210817</th>
                <th colspan="2">B. Código/Revisión; Fecha:</th>
                <th colspan="3">F-16-09-R5;270319</th>
            </thead>
            <tbody>
                <th>Datos para los Registros (Evidencia):</th>
                <th colspan="1">C. Página</th>
                <td>1</td>
                <th colspan="1">De</th>
                <td>1</td>
            </tbody>
            <tbody>
                <th>D. Fecha de elaboración:</th>
                <td class="text-center">{{form.fecha_elaboracion}}</td>
                <th>E. Periodo al que se aplica:</th>
                <td colspan="2" class="text-center;">{{form.periodo}}</td>
            </tbody>
            <tr>
                <td style="border: 1 ;" colspan="5" HEIGHT="20"></td>
            </tr>
            <tbody>
                <th colspan="3" style="font-size:larger;" class="font-weight-bold text-center">RECURSOS MATERIALES Y SERVICIOS GENERALES.</th>
                <th>1. Folio:</th>
                <td colspan="1">{{form.folio}}</td>
            </tbody>
            <tr>
                <th>2. Fecha que se requiere el bien o servicio: (dd/mm/aaaa)</th>
                <td>{{form.fecha_requerida}}</td>
                <td>
                    <table WIDTH=100%>
                        <th>3. Núm. de contrato:</th>
                        <td class="text-center">{{form.num_contrato}}</td>
                    </table>
                </td>
                <td>
                    <table WIDTH=100% HEIGHT="100">
                        <th class="text-center">4. Prioridad:</th>
                    </table>
                </td>
                <td>
                {{form.prioridad}}
                </td>
            </tr>
            <tr>
                <td>
                    <table WIDTH=100%>
                        <tr>6. Proyecto:</tr>
                        <td class="text-center">{{form.proyecto}}</td>
                    </table>
                </td>
                <td colspan="4">
                    <table WIDTH=100%>
                        <th>7. Nombre y Firma del líder del proyecto:</th>
                        <tr>
                            <td class="text-center">{{form.nombre_lider}}</td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td colspan="5" HEIGHT="10"></td>
            </tr>
            <tr>
                <th class="text-center" colspan="5">8. JUSTIFICACIÓN:</th>
            </tr>
                    <tr>
                        <td colspan="5" HEIGHT="60">{{form.justificacion}}</td>
                    </tr>
                    <tr>
                        <td colspan="5" HEIGHT="10"></td>
                    </tr>
            <tr HEIGHT="100">
                <td colspan="5">
                    <table WIDTH=100% HEIGHT="20" style="margin: 0 auto;">
                        <thead>
                            <th>9. Clave (Rec. Mat.)</th>
                            <th>10. Partida (Progr. Y Pres.)</th>
                            <th>11. Cantidad</th>
                            <th>12. Unidad de Medida</td>
                            <th>13. Concepto</th>
                            <th>14. Especificaciones Técnicas</th>
                            <th>15. Costo Unitario Aproximado</th>
                            <th>16. Subtotal</th>
                        </thead>
                        <tbody id="bienes">
                            <button type="button" class="btn btn-success mr-2" id="agregar" onclick="add()">Agregar</button>
                            <button type="button" class="btn btn-danger mr-2" onclick="eliminar()" id="elim" style="display: none;">eliminar</button>
                            <button type="button" class="btn btn-dark mr-2" id="listo" onclick="activar()">Listo</button>
                        </tbody>
                        <!--Traer Bienes de BD-->
                    </table>
                </td>
            </tr>
            <tr>
                <td colspan="4" WIDTH=50%>
                    <table WIDTH=100% HEIGHT="20" style="margin: 0 auto;">
                        <thead>
                            <th colspan="4" class="text-center">AUTORIZACIÓN DE PROGRAMACIÓN Y PRESUPUESTO</th>
                        </thead>
                        <thead>
                            <th>17. Total del Gasto:</th>
                            <th>18. Máximo Autorizado:</th>
                            <th>19. Proyecto:</th>
                            <th>20. Fuente de financiamiento:</th>
                        </thead>
                        <tr HEIGHT="20">
                            <td rowspan="3">{{form.autorizacion_totalgasto}}</td>
                            <td>{{form.max_autorizadoFE}}</td>
                            <td>{{form.presupuesto_proyectoFE}}</td>
                            <td class="text-center font-weight-bold">Federal</td>
                        </tr>
                        <tr HEIGHT="20">
                            <td>{{form.max_autorizadoES}}</td>
                            <td>{{form.presupuesto_proyectoES}}</td>
                            <td class="text-center font-weight-bold">Estatal</td>
                        </tr>
                        <tr HEIGHT="20">
                            <td>{{form.max_autorizadoIP}}</td>
                            <td>{{form.presupuesto_proyectoIP}}</td>
                            <td class="text-center font-weight-bold">IP</td>
                        </tr>
                        <tr>
                            <th class="text-center">21. FIRMA DE AUTORIZACIÓN:</th>
                            <td colspan="4">{{form.firma_autorizacion}}</td>
                        </tr>
                    </table>
                </td>
                <td>
                    <table WIDTH=100% HEIGHT="40" style="margin: 0 auto;">
                        <tr>
                            <th class="text-center">22. OBSERVACIONES:</th>
                        </tr>
                        <tr>
                            <td HEIGHT="150">{{form.observaciones}}</td>
                        </tr>
                    </table>
                </td>
                <tr>
                    <td colspan="4">
                        <table WIDTH=100% HEIGHT="40" style="margin: 0 auto;">
                            <tr>
                                <th class="text-center">23. NOMBRE Y FIRMA DE ENCARGADA DE ADMINISTRACIÓN Y FINANZAS:</th>
                            </tr>
                            <tr>
                                <td HEIGHT="50">{{form.firma_encargadafinanzas}}</td>
                            </tr>
                        </table>
                    </td>
                <td>
                    <table WIDTH=100% HEIGHT="40" style="margin: 0 auto;">
                        <thead>
                            <th class="text-center">24. NOMBRE Y FIRMA DEL RECTOR:</th>
                        </thead>
                        <tr>
                            <td HEIGHT="50">{{form.firma_rector}}</td>
                        </tr>
                    </table>
                </td>
                <thead>
                    <th class="text-center" colspan="2">25.NOMBRE Y FIRMAS DE CONFORMIDAD Y FECHA</th>
                    <td colspan="4">{{form.firmas_conformidad}}</td>
                </thead>
                <thead>
                    <th colspan="6" class="text-center">NOTA: </th>
                </thead>
                <tbody>
                    <td colspan="6" style="text-align: center;" HEIGHT="50">
                        En caso de ser monto mayores de 300 veces la UMA se deberá de verificar el procedimiento de
                        adjudicación: DIRECTA, INVITACIÓN O LICITACIÓN,
                        dependiendo de ello será el tiempo de entrega, conforme lo estipula la Ley en la materia, y
                        el área usuario deberá requisitar el anexo técnico.
                    </td>
                </tbody>
        </table><br>
    </div>

    <div class="row">
        <div class="col text-center">
            <button class="btn btn-primary" type= "button" onclick="recopilacion()">Guardar</button>
        </div>
        <!--
        <div class="col text-center">
            <button class="btn btn-primary" type="submit" onclick="prueba()">Prueba</button>
        </div>
        -->
    </div><br>
</form>

    <div style="display: none;">
        {% if bienes %}
        {% for bien in bienes %}
            <p id="{{bien.id}}" class="validados">{{ bien.id }}</p>
            <p id="{{bien.codigo_partida}}" class="validados">{{ bien.codigo_partida }}</p>
            <p id="{{bien.cantidad_bienes}}" class="validados">{{ bien.cantidad_bienes }}</p>
            <p id="{{bien.unidad_medida}}" class="validados">{{ bien.unidad_medida }}</p>
            <p id="{{bien.descrip_general_bien}}" class="validados">{{ bien.descrip_general_bien }}</p>
            <p id="{{bien.espeficaciones_tecnicas}}" class="validados">{{ bien.espeficaciones_tecnicas }}</p>
            <p id="{{bien.precio_unitario}}" class="validados">{{ bien.precio_unitario }}</p>
            <p id="{{bien.total}}" class="validados">{{ bien.total }}</p>
        {% endfor %}
        {% else %}
            <h1>No hay registros de bienes</h1>
        {% endif %}
    </div>

{% endblock %}


{% block scriptcode %}
<!-- Menu Toggle Script -->
  <!-- Menu Toggle Script -->
<script>
$("#menu-toggle").click(function(e) {
    e.preventDefault();
    $("#wrapper").toggleClass("toggled");
});
</script>

<script>
    var nod=0;
    function add(){
        console.log(nod);
        document.getElementById("elim").style.display="inline";
        document.getElementById("listo").style.display="inline";
        let container=document.getElementById("bienes");
        let insercion=`
        <tr id="fila${nod}">`;
            insercion+=`<td><select class="form-control" id="nod${nod}" onchange="cambiar('nod${nod}')">`;
            //insercion+=`<td>{{form.bien_servicio}}`;

            for (let i=0; i<arreglo.length; i++){
                if (i==0){
                    insercion+=`
                    <option value="null">Seleccionar...</option>
                    <option>${arreglo[i][0]}</option>`
                }
                else{
                    insercion+=`
                    <option>${arreglo[i][0]}</option>`
                }
            }
            
            insercion+=
            ` </select></td>
            <td id="partida${nod}"></td>
            <td id="cantidad${nod}"></td>
            <td id="unidad_medida${nod}"></td>
            <td id="concepto${nod}"></td>
            <td id="especificaciones${nod}"></td>
            <td id="costo_aprox${nod}"></td>
            <td id="subtotal${nod}"></td>
        </tr>
        `
        container.insertAdjacentHTML("beforeend",insercion)
        nod=nod+1;
    }

    function eliminar(){
        if(nod==1){
            document.getElementById("elim").style.display="none";
            document.getElementById("listo").style.display="none";
        }
        nod-=1;
        let container=document.getElementById("bienes");
        let aelim=document.getElementById(`fila${nod}`);
        console.log(`fila${nod}`)
        container.removeChild(aelim)
        
    }
    function cambiar(id){
        let ids=document.getElementById(`${id}`).value;
        console.log(ids);
        console.log(id);
        let bien_num = String(id).substring(3);
        for (let i=0; i<arreglo.length; i++){
            if(arreglo[i][0]==ids){
                document.getElementById(`partida${bien_num}`).innerText = arreglo[i][1]
                document.getElementById(`cantidad${bien_num}`).innerText = arreglo[i][2]
                document.getElementById(`unidad_medida${bien_num}`).innerText = arreglo[i][3]
                document.getElementById(`concepto${bien_num}`).innerText = arreglo[i][4]
                document.getElementById(`especificaciones${bien_num}`).innerText = arreglo[i][5]
                document.getElementById(`costo_aprox${bien_num}`).innerText = arreglo[i][6]
                document.getElementById(`subtotal${bien_num}`).innerText = arreglo[i][7]
                break
            }
            else{
                document.getElementById(`partida${bien_num}`).innerText = ''
                document.getElementById(`cantidad${bien_num}`).innerText = ''
                document.getElementById(`unidad_medida${bien_num}`).innerText = ''
                document.getElementById(`concepto${bien_num}`).innerText = ''
                document.getElementById(`especificaciones${bien_num}`).innerText = ''
                document.getElementById(`costo_aprox${bien_num}`).innerText = ''
                document.getElementById(`subtotal${bien_num}`).innerText = ''
            }
        }
    }

    var arreglo = []
    function llenado(){
        document.getElementById("listo").style.display="none";
        let bienes = document.getElementsByClassName("validados");
        let arreglo2 = []
        for (let i=0; i<bienes.length; i+=8){
            for (let a=i; a<i+8; a++){
                console.log(bienes[a].innerText);
                arreglo2.push(bienes[a].innerText);
            }
            arreglo.push(arreglo2);
            arreglo2 = []
        }
        console.log(arreglo);
    }

    window.onload=function(){
        llenado();
    }

    function activar(){
        let estado = document.getElementById("agregar").disabled;
        let conteo;
        if (estado==false){
            conteo = document.getElementById("bienes").rows.length;
            let suma = 0;
            for (let i=0; i<conteo; i++){
                console.log(document.getElementById("bienes").rows[0].id);
                let cl = document.getElementById("bienes").rows[i].id;
                cl = parseInt(cl.substring(4))
                suma += parseFloat(document.getElementById(`subtotal${i}`).innerText);
                document.getElementById(`nod${i}`).disabled = true;
            }
            console.log(suma);
            console.log(document.getElementById("total_gasto"))
            document.getElementById("total_gasto").value = suma;
            document.getElementById("agregar").disabled = true;
            document.getElementById("elim").disabled = true;
        }
        else{
            conteo = document.getElementById("bienes").rows.length;
            for (let i=0; i<conteo; i++){
                console.log(document.getElementById("bienes").rows[0].id);
                let cl = document.getElementById("bienes").rows[i].id;
                cl = parseInt(cl.substring(4))
                document.getElementById(`nod${i}`).disabled = false;
            }
            document.getElementById("total_gasto").value = 0;
            document.getElementById("agregar").disabled = false;
            document.getElementById("elim").disabled = false;
        }
    }

    function recopilacion(){
        let promy = new Promise((resolve, reject)=>{
            let fecha_elaboracion = document.getElementById("datepicker").value;
            //console.log(fecha_elaboracion);
            if(fecha_elaboracion=="" || fecha_elaboracion==null){
                alert('Completa el campo de la fecha de elaboración');
                resolve({fecha_elaboracion:0, error:1})
            }
            else{
                resolve({fecha_elaboracion:fecha_elaboracion, error: 0})
            }
        }).then(res=>{
            console.log(res);
            if(res["error"]==0){
                let periodo = document.getElementById("id_periodo").value;
                if(periodo=="" || periodo==null){
                    alert('Completa el campo de periodo al que aplica');
                    return({fecha_elaboracion:0, periodo:0, error:1})
                }
                else{
                    return({fecha_elaboracion:res["fecha_elaboracion"], periodo:periodo, error:0})
                }
            }
            else{
                return({fecha_elaboracion:0, periodo:0, error:1})
            }
        }).then(res=>{
            console.log(res);
            if(res["error"]==0){
                let folio = document.getElementById("id_folio").value;
                if(folio==null || folio==NaN || folio==""){
                    alert('Completa el campo folio');
                    return({fecha_elaboracion:0, periodo:0, folio:0, error:1})
                }
                else{
                    return({fecha_elaboracion:res["fecha_elaboracion"], periodo:res["periodo"], folio:folio, error:0})
                }
            }
            else{
                return({fecha_elaboracion:0, periodo:0, folio:0, error:1})
            }
        }).then(res=>{
            console.log(res);
            if(res["error"]==0){
                let fecha_requerida = document.getElementById("id_fecha_requerida").value;
                if(fecha_requerida=="" || fecha_requerida==null){
                    alert('Completa el campo fecha requerida');
                    return({fecha_elaboracion:0, periodo:0, folio:0, fecha_requerida:0, error:1})
                }
                else{
                    return({fecha_elaboracion:res["fecha_elaboracion"], periodo:res["periodo"], folio:res["folio"], fecha_requerida:fecha_requerida, error:0})
                }
            }
            else{
                return({fecha_elaboracion:0, periodo:0, folio:0, fecha_requerida:0, error:1})
            }
        }).then(res=>{
            console.log(res);
            if(res["error"]==0){
                let num_contrato = document.getElementById("id_num_contrato").value;
                if(num_contrato==null || num_contrato==NaN || num_contrato==""){
                    alert('Completa el campo numero de contrato');
                    return({fecha_elaboracion:0, periodo:0, fecha_requerida:0, folio:0, num_contrato:0, error:1})
                }
                else{
                    return({fecha_elaboracion:res["fecha_elaboracion"], periodo:res["periodo"], fecha_requerida:res["fecha_requerida"], folio:res["folio"], num_contrato:num_contrato, error:0})
                }
            }
            else{
                return({fecha_elaboracion:0, periodo:0, fecha_requerida:0, folio:0, num_contrato:0, error:1})
            }
        }).then(res=>{
            console.log(res);
            if(res["error"]==0){
                let prioridad= document.getElementById("id_prioridad").value;
                if(prioridad=="" || prioridad==null){
                    alert('Completa el campo numero de prioridad');
                    return({fecha_elaboracion:0, periodo:0, fecha_requerida:0, folio:0, num_contrato:0, prioridad:0, error:1})
                }
                else{
                    return({fecha_elaboracion:res["fecha_elaboracion"], periodo:res["periodo"], fecha_requerida:res["fecha_requerida"], folio:res["folio"], num_contrato:res["num_contrato"], prioridad:prioridad, error:0})
                }
            }
            else{
                return({fecha_elaboracion:0, periodo:0, fecha_requerida:0, folio:0, num_contrato:0, prioridad:0, error:1})
            }
        }).then(res=>{
            console.log(res);
            if(res["error"]==0){
                let proyecto= document.getElementById("id_proyecto").value;
                if(proyecto=="" || proyecto==null){
                    alert('Completa el campo numero de proyecto');
                    return({fecha_elaboracion:0, periodo:0, fecha_requerida:0, folio:0, num_contrato:0, prioridad:0, proyecto:0, error:1})
                }
                else{
                    return({fecha_elaboracion:res["fecha_elaboracion"], periodo:res["periodo"], fecha_requerida:res["fecha_requerida"], folio:res["folio"], num_contrato:res["num_contrato"], prioridad:res["prioridad"], proyecto:proyecto ,error:0})
                }
            }
            else{
                return({fecha_elaboracion:0, periodo:0, fecha_requerida:0, folio:0, num_contrato:0, prioridad:0, proyecto:0, error:1})
            }
        }).then(res=>{
            console.log(res);
            if(res["error"]==0){
                let nombre_lider= document.getElementById("id_nombre_lider").value;
                if(nombre_lider=="" || nombre_lider==null){
                    alert('Completa el campo de nombre lider');
                    return({fecha_elaboracion:0, periodo:0, fecha_requerida:0, folio:0, num_contrato:0, prioridad:0, proyecto:0, nombre_lider:0, error:1})
                }
                else{
                    return({fecha_elaboracion:res["fecha_elaboracion"], periodo:res["periodo"], fecha_requerida:res["fecha_requerida"], folio:res["folio"], num_contrato:res["num_contrato"], prioridad:res["prioridad"], proyecto:res["proyecto"], nombre_lider:nombre_lider ,error:0})
                }
            }
            else{
                return({fecha_elaboracion:0, periodo:0, fecha_requerida:0, folio:0, num_contrato:0, prioridad:0, proyecto:0, nombre_lider:0, error:1})
            }
        }).then(res=>{
            console.log(res);
            if(res["error"]==0){
                let autorizacion_totalgasto= document.getElementById("total_gasto").value;
                if(autorizacion_totalgasto==null || autorizacion_totalgasto==NaN || autorizacion_totalgasto==""){
                    alert('Completa el campo de gasto total');
                    return({fecha_elaboracion:0, periodo:0, fecha_requerida:0, folio:0, num_contrato:0, prioridad:0, proyecto:0, nombre_lider:0, autorizacion_totalgasto:0, error:1})
                }
                else{
                    return({fecha_elaboracion:res["fecha_elaboracion"], periodo:res["periodo"], fecha_requerida:res["fecha_requerida"], folio:res["folio"], num_contrato:res["num_contrato"], prioridad:res["prioridad"], proyecto:res["proyecto"], nombre_lider:res["nombre_lider"], autorizacion_totalgasto:autorizacion_totalgasto,error:0})
                }
            }
            else{
                return({fecha_elaboracion:0, periodo:0, fecha_requerida:0, folio:0, num_contrato:0, prioridad:0, proyecto:0, nombre_lider:0, autorizacion_totalgasto:0, error:1})
            }
        }).then(res=>{
            if(res["error"]==0){
                if(nod==0){
                    alert('No se han llenado los bienes y servicios');
                    return({error:1});
                }
                else{
                    return(res);
                }
            }
            else{
                return({error:1});
            }
        }).then(res=>{
            console.log(res);
            if(res["error"]==0){
                let justificacion = document.getElementById("id_justificacion").value;
                let max_autorizadoFE = document.getElementById("id_max_autorizadoFE").value;
                let max_autorizadoES = document.getElementById("id_max_autorizadoES").value;
                let max_autorizadoIP = document.getElementById("id_max_autorizadoIP").value;
                let presupuesto_proyectoFE = document.getElementById("id_presupuesto_proyectoFE").value;
                let presupuesto_proyectoES = document.getElementById("id_presupuesto_proyectoES").value;
                let presupuesto_proyectoIP = document.getElementById("id_presupuesto_proyectoIP").value;
                let firma_autorizacion = document.getElementById("id_firma_autorizacion").value;
                let observaciones = document.getElementById("id_observaciones").value;
                let firma_encargadafinanzas = document.getElementById("id_firma_encargadafinanzas").value;
                let firma_rector = document.getElementById("id_firma_rector").value;
                let firmas_conformidad = document.getElementById("id_firmas_conformidad").value;
                console.log(nod);
                let envio = {csrfmiddlewaretoken: '{{ csrf_token }}', fecha_elaboracion:res["fecha_elaboracion"], periodo:res["periodo"], fecha_requerida:res["fecha_requerida"], folio:res["folio"], num_contrato:res["num_contrato"], prioridad:res["prioridad"], proyecto:res["proyecto"], nombre_lider:res["nombre_lider"], autorizacion_totalgasto:res["autorizacion_totalgasto"], justificacion:justificacion, max_autorizadoES:max_autorizadoES, max_autorizadoFE:max_autorizadoFE, max_autorizadoIP:max_autorizadoIP, presupuesto_proyectoES:presupuesto_proyectoES, presupuesto_proyectoFE:presupuesto_proyectoFE, presupuesto_proyectoIP:presupuesto_proyectoIP, firma_autorizacion:firma_autorizacion, observaciones:observaciones, firma_encargadafinanzas:firma_encargadafinanzas, firma_rector:firma_rector, firmas_conformidad:firmas_conformidad}
                let url = '/usuario/requisicion/data/'
                let data = envio
                $.ajax({
                    type: "POST",
                    url: url,
                    data: data,
                    success: function() {
                        //window.location.reload();
                        console.log("listo1");
                    },
                });
                return(nod);
            }
        }).then(res=>{
            let diccionario={csrfmiddlewaretoken: '{{ csrf_token }}'};
            for(let i=0; i<res; i++){
                let valor = document.getElementById(`nod${i}`).value;
                diccionario[`id${i}`]=valor;
            }
            let url = '/usuario/requisicion/bienes/'
            let data = diccionario
            $.ajax({
                type: "POST",
                url: url,
                data: data,
                success: function() {
                    window.location.reload();
                    console.log("listo2");
                },
            });
        })
    }

</script>
{% endblock %}
